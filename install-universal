#!/usr/bin/bash

# Universal Installer for WM Configuration
# Supports Debian/Ubuntu, Arch Linux, and Fedora

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
NC='\033[0m' # No Color

print_header() {
    echo -e "${PURPLE}"
    echo "╔════════════════════════════════════════╗"
    echo "║     Window Manager Configuration       ║"
    echo "║         Installation Script            ║"
    echo "╚════════════════════════════════════════╝"
    echo -e "${NC}"
}

print_status() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

detect_distro() {
    if [ -f /etc/os-release ]; then
        . /etc/os-release
        DISTRO=$ID
    elif type lsb_release >/dev/null 2>&1; then
        DISTRO=$(lsb_release -si)
    elif [ -f /etc/lsb-release ]; then
        . /etc/lsb-release
        DISTRO=$DISTRIB_ID
    elif [ -f /etc/debian_version ]; then
        DISTRO="debian"
    elif [ -f /etc/fedora-release ]; then
        DISTRO="fedora"
    elif [ -f /etc/arch-release ]; then
        DISTRO="arch"
    else
        DISTRO="unknown"
    fi
    
    echo $DISTRO
}

main() {
    print_header
    
    DISTRO=$(detect_distro)
    print_status "Detected distribution: $DISTRO"
    
    case $DISTRO in
        "debian"|"ubuntu"|"pop"|"mint")
            print_status "Using Debian/Ubuntu installer..."
            if [ -f "./install-debian" ]; then
                chmod +x ./install-debian
                ./install-debian
            else
                print_error "Debian installer not found!"
                exit 1
            fi
            ;;
        "arch"|"manjaro"|"endeavouros")
            print_status "Using Arch Linux installer..."
            if [ -f "./install-arch" ]; then
                chmod +x ./install-arch
                ./install-arch
            else
                print_error "Arch installer not found!"
                exit 1
            fi
            ;;
        "fedora"|"rhel"|"centos")
            print_status "Using Fedora installer..."
            if [ -f "./install-fedora" ]; then
                chmod +x ./install-fedora
                ./install-fedora
            else
                print_error "Fedora installer not found!"
                exit 1
            fi
            ;;
        *)
            print_error "Unsupported distribution: $DISTRO"
            echo ""
            print_status "Supported distributions:"
            echo "  • Debian/Ubuntu (and derivatives)"
            echo "  • Arch Linux (and derivatives)"
            echo "  • Fedora/RHEL (and derivatives)"
            echo ""
            print_status "You can manually run one of the following:"
            echo "  • ./install-debian (for Debian/Ubuntu)"
            echo "  • ./install-arch   (for Arch Linux)"
            echo "  • ./install-fedora (for Fedora)"
            exit 1
            ;;
    esac
}

# Check if script is being run as root
if [ "$EUID" -eq 0 ]; then
    print_error "Please do not run this script as root!"
    print_status "The script will ask for sudo permissions when needed."
    exit 1
fi

# Run main function
main
